<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scan History</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f4f6f8;
        }

        body::before {
            content: "";
            background-image: url("{{ url_for('static', filename='css/logo.png') }}");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
            opacity: 0.1;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* NAVBAR */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0a2540;
            padding: 15px 30px;
            color: white;
        }

        .top-nav h2 {
            margin: 0;
        }

        .top-nav .links a {
            margin-left: 10px;
        }

        /* BUTTON */
        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            background-color: #2d4c6d;
            color: white;
            border: none;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
        }

        .btn:hover {
            background-color: #1a3a5a;
        }

        /* FILTER BAR */
        .filter-bar {
            text-align: center;
            margin: 30px 0;
        }

        .filter-bar input,
        .filter-bar select {
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid #2d4c6d;
            margin: 5px;
            outline: none;
        }

        .filter-bar button {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            background-color: #2d4c6d;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        .filter-bar button:hover {
            background-color: #1a3a5a;
        }

        /* TABLE */
        table {
            margin: 40px auto;
            border-collapse: collapse;
            width: 92%;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
        }

        th {
            background-color: #2d4c6d;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f4f6f8;
        }

        .result-safe {
            color: green;
            font-weight: bold;
        }

        .result-phishing {
            color: red;
            font-weight: bold;
        }

        .result-neutral {
            color: orange;
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div class="top-nav">
    <h2>Scan History</h2>

    {% if session.get('email_id') %}
    <div class="links">
        <span>Hello, {{ session['name'] }}</span>
        <a href="{{ url_for('dashboard') }}" class="btn">Dashboard</a>
        <a href="{{ url_for('scan') }}" class="btn">Scan</a>
        <a href="{{ url_for('home') }}" class="btn">Home</a>
        <a href="{{ url_for('logout') }}" class="btn">Logout</a>
    </div>
    {% endif %}
</div>

<!-- FILTER -->
<div class="filter-bar">
    <form method="GET" action="{{ url_for('history') }}">
        <input type="text" name="query" placeholder="Search email content"
               value="{{ request.args.get('query', '') }}">

        <select name="filter">
            <option value="">All</option>
            <option value="PHISHING" {% if request.args.get('filter')=='PHISHING' %}selected{% endif %}>Phishing</option>
            <option value="SAFE" {% if request.args.get('filter')=='SAFE' %}selected{% endif %}>Safe</option>
            <option value="NEUTRAL" {% if request.args.get('filter')=='NEUTRAL' %}selected{% endif %}>Neutral</option>
        </select>

        <select name="order">
            <option value="desc" {% if order=='desc' %}selected{% endif %}>Newest First</option>
            <option value="asc" {% if order=='asc' %}selected{% endif %}>Oldest First</option>
        </select>

        <button type="submit">Apply</button>
    </form>
</div>

<!-- HISTORY TABLE -->
<table>
    <tr>
        {% if is_admin %}
            <th>ID</th>
            <th>Email ID</th>
        {% endif %}
        <th>Email Content</th>
        <th>Result</th>
        <th>Risk Score</th>
        <th>Date</th>
        <th>Action</th>
    </tr>

    {% for row in data %}
    <tr>
        {% if is_admin %}
            <td>{{ row[0] }}</td>
            <td>{{ row[1] }}</td>
            <td>{{ row[2] }}</td>
            <td class="result-{{ row[3]|lower }}">{{ row[3] }}</td>
            <td>{{ row[4] }}%</td>
            <td>{{ row[5] }}</td>
            <td>
                <form method="POST"
                      action="{{ url_for('delete_history', history_id=row[0]) }}">
                    <button class="btn"
                            onclick="return confirm('Delete this scan?')">
                        Delete
                    </button>
                </form>
            </td>
        {% else %}
            <td>{{ row[1] }}</td>
            <td class="result-{{ row[2]|lower }}">{{ row[2] }}</td>
            <td>{{ row[3] }}%</td>
            <td>{{ row[4] }}</td>
            <td>
                <form method="POST"
                      action="{{ url_for('delete_history', history_id=row[0]) }}">
                    <button class="btn"
                            onclick="return confirm('Delete this scan?')">
                        Delete
                    </button>
                </form>
            </td>
        {% endif %}
    </tr>
    {% endfor %}
</table>

</body>
</html>
